---
- name: Check patch compliance and generate report
  hosts: env_Development
  become: true
  gather_facts: true
  vars_files:
    - /home/ubuntu/Autopatch-Ansible/group_vars/all/vars.yml
    - /home/ubuntu/Autopatch-Ansible/group_vars/all/pass.yml

  tasks:
    - name: Display playbook start message
      debug:
        msg: "Starting patch compliance check for {{ inventory_hostname }}"

    - name: Include check_updates role
      include_role:
        name: check_updates

- name: Generate and send compliance report
  hosts: localhost
  vars_files:
    - /home/ubuntu/Autopatch-Ansible/group_vars/all/vars.yml
    - /home/ubuntu/Autopatch-Ansible/group_vars/all/pass.yml
  gather_facts: true
  vars:
    report_title: "Security Patch Compliance Report"
    max_days_without_update: 30

  tasks:
    - name: Include report role
      include_role:
        name: report

